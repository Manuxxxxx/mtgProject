<!DOCTYPE html>
<html>
<head>
  <title>Synergy Graph Visualizer</title>
  <script src="https://unpkg.com/cytoscape@3.21.1/dist/cytoscape.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    #cy {
      width: 100%;
      height: 800px;
      border: 1px solid #ccc;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h2>MTG Synergy Graph</h2>

<label for="sets">Select Sets (max 5):</label>
<select id="sets" multiple size="10">
  {% for s in sets %}
    <option value="{{ s }}">{{ s }}</option>
  {% endfor %}
</select>

<br><br>

<label for="min_score">Min Score:</label>
<input type="number" step="0.01" id="min_score" value="0.90" min="0" max="1">

<label for="max_score">Max Score:</label>
<input type="number" step="0.01" id="max_score" value="1.00" min="0" max="1">

<button onclick="loadGraph()">Update Graph</button>

<div id="cy"></div>

<script>
function loadGraph() {
  const selectedSets = Array.from(document.getElementById("sets").selectedOptions)
                            .slice(0, 5)
                            .map(opt => opt.value);
  const min_score = document.getElementById("min_score").value;
  const max_score = document.getElementById("max_score").value;

  const params = new URLSearchParams();
  selectedSets.forEach(s => params.append("sets[]", s));
  params.append("min_score", min_score);
  params.append("max_score", max_score);

  fetch("/graph_data?" + params.toString())
    .then(res => res.json())
    .then(data => {
      cytoscape({
        container: document.getElementById('cy'),
        elements: {
          nodes: data.nodes,
          edges: data.edges
        },
        layout: {
          name: 'preset'
        },
        style: [
          {
            selector: 'node',
            style: {
              'label': 'data(label)',
              'width': 10,
              'height': 10,
              'background-color': '#0074D9'
            }
          },
          {
            selector: 'edge',
            style: {
              'width': 'data(width)',
              'line-color': '#999',
              'target-arrow-shape': 'triangle'
            }
          }
        ]
      });
    });
}

window.onload = () => {
  document.getElementById("sets").selectedIndex = 0;
  loadGraph();
};
</script>

</body>
</html>
